# 接触式磁检测仪器软件 - 产品需求文档 (PRD)

## 1. 项目概述

### 1.1 项目背景
开发一款基于Web的接触式磁检测仪器软件，复现DOPPLER品牌磁检测仪器的工业级界面和功能，提供高端、现代化的磁检测解决方案。

### 1.2 项目目标
- 完全复现磁检测仪器的工业界面设计（橙色+黑色配色方案）
- 实现符合ISO 9934-1:2016标准的磁检测实验流程
- 提供实时磁信号波形采集与分析功能
- 支持完整的实验数据管理和报告生成
- 打造高端、专业的工业化用户体验

### 1.3 目标用户
- 无损检测（NDT）工程师
- 质量控制人员
- 工业检测实验室技术人员
- 磁检测设备操作员

### 1.4 产品定位
工业级Web端磁检测仪器控制软件，提供专业的磁粉检测、磁漏检测功能。

---

## 2. 国际标准依据

### 2.1 ISO 9934-1:2016《无损检测 磁粉检测 第1部分：总则》
本产品严格遵循以下标准要求：

1. **检测人员要求**：记录操作人员信息和资质
2. **检测工艺规程**：标准化的检测流程和参数设置
3. **工件表面准备**：记录工件准备状态
4. **工件磁化方法**：支持多种磁化方式（直接磁化、间接磁化、剩磁法等）
5. **检测介质**：记录使用的磁粉类型和浓度
6. **观察条件**：环境光照、紫外线强度等参数
7. **综合性能检验**：系统性能自检和校准
8. **显示记录与解释**：缺陷记录和分析
9. **工件退磁**：退磁过程记录
10. **工件清洗**：清洗过程记录
11. **检测报告**：完整的检测报告生成

### 2.2 其他相关标准
- ASTM E1444 - 磁粉检测标准实践
- EN ISO 9934 系列 - 欧洲磁粉检测标准
- GB/T 15822 系列 - 中国磁粉检测标准

---

## 3. 功能需求

### 3.1 核心功能模块

#### 3.1.1 仪器主界面（P1 - 最高优先级）
**用户故事**：作为操作员，我需要一个直观的工业化界面来控制检测仪器。

**功能描述**：
- 完整复现DOPPLER仪器的外观设计
- 橙色+黑色工业配色方案
- 左侧功能按钮区：播放/暂停、上传、显示模式(DISP)、接地、门控(GATE)、VPA
- 右侧控制按钮区：回退、保存(SAVE)、菜单(MENU)
- 中央显示屏：主工作区域
- 顶部数据表格：实时显示关键参数
- 底部品牌标识：DOPPLER商标

**技术要求**：
- 响应式设计，支持全屏显示
- 仿真硬件按钮的点击效果
- 工业级视觉设计（金属质感、LED指示灯等）

#### 3.1.2 磁信号实时波形显示（P1 - 最高优先级）
**用户故事**：作为检测工程师，我需要实时查看磁信号波形以判断缺陷位置。

**功能描述**：
- 实时采集并显示磁信号波形（A-scan波形）
- 双通道信号显示（横向和纵向磁化）
- 波形参数：幅值、频率、相位
- 缺陷标记功能
- 波形回放功能
- 信号增益调节（1x, 2x, 5x, 10x, 20x）
- 扫描速度调节

**技术要求**：
- 使用ECharts或Chart.js实现实时图表
- 60fps流畅渲染
- 支持波形缩放、平移
- 数据实时同步到Supabase

#### 3.1.3 实验数据管理（P1 - 最高优先级）
**用户故事**：作为质量工程师，我需要记录和管理所有检测实验数据。

**功能描述**：
- 创建新实验项目
- 实验信息录入：
  - 工件信息（名称、材料、规格、批次号）
  - 检测标准（ISO 9934-1等）
  - 操作人员信息
  - 检测日期和时间
- 实验参数配置：
  - 磁化方式（直流、交流、脉冲）
  - 磁化强度（特斯拉T）
  - 磁粉类型（干粉、湿法）
  - 检测灵敏度等级
- 保存实验数据到Supabase
- 加载历史实验
- 实验数据搜索和过滤

#### 3.1.4 文件管理系统（P2）
**用户故事**：作为操作员，我需要管理检测文件和记录。

**功能描述**：
- 文件列表显示（树形结构）
- 文件操作：新建、打开、删除、重命名
- 文件分类：实验数据、报告、图像、设置
- 文件搜索功能
- 文件导出（本地下载）
- 云端同步（Supabase Storage）

#### 3.1.5 参数配置界面（P2）
**用户故事**：作为技术人员，我需要精确配置检测参数。

**功能描述**：
- **磁化参数**：
  - 磁化电流：0-2000mA，步进10mA
  - 磁化频率：50Hz/60Hz/DC
  - 磁化时间：0.5-10秒
- **门控参数**：
  - 门控位置：0-100mm
  - 门控宽度：1-50mm
  - 门控阈值：0-100%
- **增益参数**：
  - 信号增益：0-100dB
  - 噪声抑制：开/关
  - 滤波器设置：低通/高通/带通
- **显示参数**：
  - 波形颜色
  - 网格显示
  - 坐标轴范围
- 参数预设保存与加载
- 参数导入导出

#### 3.1.6 数据分析与报告（P2）
**用户故事**：作为质量工程师，我需要生成专业的检测报告。

**功能描述**：
- 缺陷自动识别算法
- 缺陷定位（X/Y坐标，深度估算）
- 缺陷分类（裂纹、气孔、夹杂等）
- 缺陷严重程度评估
- 统计分析：
  - 缺陷数量统计
  - 缺陷分布图
  - 合格率计算
- 报告生成：
  - PDF格式检测报告
  - Excel数据导出
  - 图像截图保存
- 报告模板自定义

#### 3.1.7 系统设置（P3）
**用户故事**：作为管理员，我需要配置系统参数。

**功能描述**：
- 用户管理（登录、权限）
- 设备校准记录
- 系统日志查看
- 数据备份与恢复
- 语言设置（中文/英文）
- 主题设置
- 关于页面

---

## 4. 数据库设计

### 4.1 数据表结构（Supabase）

#### 4.1.1 实验项目表 (experiments)
```sql
- id: UUID (主键)
- project_name: 项目名称
- workpiece_name: 工件名称
- workpiece_material: 工件材料
- workpiece_spec: 工件规格
- batch_number: 批次号
- standard_reference: 检测标准
- operator_name: 操作员
- operator_cert: 操作员资质
- test_date: 检测日期
- magnetization_method: 磁化方式
- magnetization_current: 磁化电流(mA)
- magnetization_frequency: 磁化频率(Hz)
- magnetic_powder_type: 磁粉类型
- sensitivity_level: 灵敏度等级
- test_result: 检测结果（合格/不合格）
- remarks: 备注
- created_at: 创建时间
- updated_at: 更新时间
```

#### 4.1.2 磁信号数据表 (signal_data)
```sql
- id: UUID (主键)
- experiment_id: 实验ID (外键)
- channel: 通道号 (1/2)
- timestamp: 时间戳
- position: 扫描位置(mm)
- amplitude: 信号幅值(mV)
- frequency: 频率(Hz)
- phase: 相位(度)
- created_at: 创建时间
```

#### 4.1.3 缺陷记录表 (defects)
```sql
- id: UUID (主键)
- experiment_id: 实验ID (外键)
- defect_type: 缺陷类型
- position_x: X坐标(mm)
- position_y: Y坐标(mm)
- depth_estimate: 深度估算(mm)
- length: 长度(mm)
- width: 宽度(mm)
- severity: 严重程度(1-5)
- signal_amplitude: 信号幅值(mV)
- image_url: 缺陷图像URL
- description: 描述
- created_at: 创建时间
```

#### 4.1.4 参数配置表 (configurations)
```sql
- id: UUID (主键)
- config_name: 配置名称
- magnetization_current: 磁化电流
- gain: 增益(dB)
- gate_position: 门控位置(mm)
- gate_width: 门控宽度(mm)
- gate_threshold: 门控阈值(%)
- filter_type: 滤波器类型
- is_default: 是否默认配置
- created_at: 创建时间
```

#### 4.1.5 用户表 (users)
```sql
- id: UUID (主键)
- username: 用户名
- email: 邮箱
- role: 角色（admin/operator/viewer）
- certification: 资质证书
- created_at: 创建时间
```

#### 4.1.6 系统日志表 (system_logs)
```sql
- id: UUID (主键)
- user_id: 用户ID
- action: 操作类型
- description: 操作描述
- ip_address: IP地址
- created_at: 创建时间
```

---

## 5. 用户界面设计

### 5.1 界面布局

```
┌─────────────────────────────────────────────────────────────────┐
│                    DOPPLER 磁检测仪器界面                          │
├──────┬──────────────────────────────────────────────────┬────────┤
│      │  [数据表格区域 - 实时参数显示]                      │        │
│ 左   ├──────────────────────────────────────────────────┤  右    │
│ 侧   │                                                  │  侧    │
│      │                                                  │        │
│ 功   │         主显示区域                                │  控    │
│ 能   │      (波形图/文件管理/配置界面)                    │  制    │
│      │                                                  │        │
│ 按   │                                                  │  按    │
│ 钮   │                                                  │  钮    │
│      │                                                  │        │
│ 区   └──────────────────────────────────────────────────┘  区    │
│                     DOPPLER 品牌标识                              │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 配色方案
- **主色调**：橙色 (#FF6B00) - 工业活力感
- **辅色调**：深灰色 (#2A2A2A) - 专业稳重
- **背景色**：黑色 (#1A1A1A) - 高端科技感
- **强调色**：白色 (#FFFFFF) - 信息展示
- **成功色**：绿色 (#00FF00) - 状态指示
- **警告色**：黄色 (#FFFF00) - 异常提醒
- **危险色**：红色 (#FF0000) - 错误警报

### 5.3 字体规范
- **主标题**：微软雅黑 Bold 24px
- **副标题**：微软雅黑 Regular 18px
- **正文**：微软雅黑 Regular 14px
- **按钮文字**：微软雅黑 Bold 16px
- **数据显示**：Courier New 14px（等宽字体）

---

## 6. 技术架构

### 6.1 技术栈选择
- **前端框架**：纯HTML5 + CSS3 + JavaScript (ES6+)
  - 理由：简单直接，无需构建工具，适合AI编程工具
- **UI组件**：原生JavaScript + 自定义组件
- **图表库**：ECharts 5.x（强大的工业级图表库）
- **后端服务**：Supabase (BaaS)
  - PostgreSQL数据库
  - 实时订阅功能
  - 存储服务
  - 认证服务
- **部署平台**：Netlify
  - 静态网站托管
  - CDN加速
  - HTTPS支持

### 6.2 项目文件结构
```
maguiweb/
├── index.html              # 主界面
├── css/
│   ├── main.css           # 主样式
│   ├── industrial.css     # 工业风格样式
│   └── responsive.css     # 响应式样式
├── js/
│   ├── app.js            # 应用主逻辑
│   ├── supabase-client.js # Supabase连接
│   ├── signal-chart.js    # 信号图表
│   ├── data-manager.js    # 数据管理
│   ├── file-system.js     # 文件管理
│   └── report-generator.js # 报告生成
├── assets/
│   ├── images/           # 图标和图片
│   └── fonts/            # 字体文件
├── lib/
│   └── echarts.min.js    # ECharts库
├── docs/
│   ├── PRD.md            # 产品需求文档
│   ├── README.md         # 项目说明
│   └── API.md            # API文档
├── netlify.toml          # Netlify配置
├── .env.example          # 环境变量示例
└── package.json          # 依赖管理
```

### 6.3 关键技术实现

#### 6.3.1 实时信号采集
- 使用Web API模拟信号采集
- 数据流处理：每秒采集1000个点
- 实时渲染：ECharts流式渲染
- 数据存储：批量写入Supabase（每10秒）

#### 6.3.2 数据同步
- Supabase Realtime订阅
- 多设备数据同步
- 离线模式支持（LocalStorage缓存）

#### 6.3.3 报告生成
- 使用jsPDF生成PDF报告
- 使用SheetJS导出Excel
- Canvas截图保存波形图

---

## 7. 性能指标

### 7.1 响应时间
- 界面加载时间：< 2秒
- 按钮响应时间：< 100ms
- 图表渲染帧率：≥ 60fps
- 数据保存时间：< 1秒

### 7.2 数据处理能力
- 实时信号采集率：1000点/秒
- 最大实验数据存储：每个实验100MB
- 并发用户数：100+

### 7.3 兼容性
- 浏览器：Chrome 90+, Edge 90+, Firefox 88+
- 屏幕分辨率：1920x1080 及以上
- 触控支持：支持触摸屏操作

---

## 8. 安全性要求

### 8.1 数据安全
- 所有数据传输使用HTTPS
- Supabase RLS (Row Level Security) 行级安全策略
- 敏感数据加密存储

### 8.2 用户认证
- Supabase Auth身份验证
- 角色权限控制（RBAC）
- 操作日志审计

### 8.3 数据备份
- Supabase自动备份
- 定期数据导出
- 灾难恢复计划

---

## 9. 测试计划

### 9.1 功能测试
- 所有按钮和交互功能测试
- 数据输入验证测试
- 文件操作测试
- 报告生成测试

### 9.2 性能测试
- 长时间运行稳定性测试
- 大数据量处理测试
- 并发用户测试

### 9.3 兼容性测试
- 多浏览器测试
- 多屏幕分辨率测试
- 触控设备测试

### 9.4 安全测试
- SQL注入测试
- XSS攻击测试
- 权限控制测试

---

## 10. 项目里程碑

### 第一阶段：基础框架（1-2天）
- ✅ PRD文档编制
- ✅ README文档编制
- ⬜ 项目初始化
- ⬜ Supabase数据库设计
- ⬜ 基础界面框架

### 第二阶段：核心功能（3-5天）
- ⬜ 仪器主界面开发
- ⬜ 磁信号实时波形显示
- ⬜ 实验数据管理模块
- ⬜ 参数配置界面

### 第三阶段：扩展功能（2-3天）
- ⬜ 文件管理系统
- ⬜ 数据分析功能
- ⬜ 报告生成功能
- ⬜ 系统设置

### 第四阶段：测试优化（1-2天）
- ⬜ 功能测试
- ⬜ 性能优化
- ⬜ 用户体验优化

### 第五阶段：部署上线（1天）
- ⬜ Netlify部署
- ⬜ 生产环境测试
- ⬜ 文档完善

---

## 11. 风险评估

### 11.1 技术风险
- **实时数据处理性能**：使用Web Worker处理大量数据
- **跨浏览器兼容性**：使用Polyfill确保兼容性
- **Supabase连接稳定性**：实现离线模式和重连机制

### 11.2 业务风险
- **用户学习成本**：提供详细的用户手册和视频教程
- **数据准确性**：严格的数据验证和校准流程

---

## 12. 未来扩展

### 12.1 短期规划（6个月内）
- 移动端适配（响应式优化）
- 多语言支持（英文、日文）
- AI辅助缺陷识别

### 12.2 长期规划（1年内）
- 云端协作功能
- 大数据分析平台
- 机器学习模型训练
- 3D可视化

---

## 13. 附录

### 13.1 术语表
- **MFL**：Magnetic Flux Leakage（磁漏检测）
- **MT**：Magnetic Testing（磁粉检测）
- **NDT**：Non-Destructive Testing（无损检测）
- **A-scan**：幅度扫描波形
- **RLS**：Row Level Security（行级安全）

### 13.2 参考文档
- ISO 9934-1:2016 无损检测 磁粉检测 第1部分：总则
- ASTM E1444 磁粉检测标准实践
- Supabase官方文档
- ECharts官方文档

---

**文档版本**：v1.0  
**编制日期**：2025-10-07  
**编制人**：AI Full-Stack Developer  
**审核状态**：待审核
