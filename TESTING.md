# 测试计划 - DOPPLER 磁检测仪器系统

## 测试概述

本文档描述了 DOPPLER 磁检测仪器Web控制系统的完整测试计划和测试用例。

---

## 测试环境

### 浏览器支持
- ✅ Chrome 90+
- ✅ Microsoft Edge 90+
- ✅ Firefox 88+
- ⚠️ Safari 14+ (部分功能可能需要调整)

### 测试设备
- 桌面端: 1920x1080, 1366x768
- 平板: 768x1024
- 移动端: 375x812

---

## MVP 功能测试（Phase 1-5）

### 1. US1 - 实时磁信号监测与波形显示

#### 测试用例 1.1: 波形图初始化
**步骤**:
1. 打开网站
2. 点击"查看波形"按钮

**预期结果**:
- [  ] 波形图容器正常显示
- [ ] 图表标题显示"磁信号波形实时监测"
- [ ] X轴标签为"时间(s)"，Y轴标签为"幅值(mV)"
- [ ] 显示通道1和通道2的图例

#### 测试用例 1.2: 实时波形更新
**步骤**:
1. 在波形图界面
2. 点击左侧"播放/暂停"按钮(▶)

**预期结果**:
- [ ] 按钮图标变为"⏸"
- [ ] 波形开始实时更新
- [ ] 波形流畅，无明显卡顿（≥30fps）
- [ ] 顶部数据表格实时更新幅值

#### 测试用例 1.3: 双通道切换
**步骤**:
1. 波形监测中
2. 点击"切换通道"按钮

**预期结果**:
- [ ] 显示通知"切换到通道X"
- [ ] 非当前通道的波形透明度降低

#### 测试用例 1.4: 缺陷自动标记
**步骤**:
1. 波形监测中
2. 等待出现幅值>80mV的信号

**预期结果**:
- [ ] 超过阈值的点自动标记为红色
- [ ] 顶部状态显示"检测到缺陷"
- [ ] 控制台输出缺陷信息

#### 测试用例 1.5: 波形缩放
**步骤**:
1. 在波形图上使用鼠标滚轮或拖动选择区域

**预期结果**:
- [ ] 可以放大/缩小波形
- [ ] 可以拖动平移
- [ ] 点击"重置缩放"恢复原始视图

---

### 2. US2 - 实验项目创建与数据记录

#### 测试用例 2.1: 新建实验
**步骤**:
1. 点击"MENU"按钮
2. 点击"新建实验"按钮
3. 填写表单：
   - 项目名称: "钢板焊缝检测-测试"
   - 工件名称: "Q345钢板"
   - 操作员姓名: "张三"
   - 磁化方式: "直流磁化"
4. 点击"保存实验"

**预期结果**:
- [ ] 表单验证通过
- [ ] 显示"实验创建成功！"通知
- [ ] 自动跳转到实验列表
- [ ] 新实验出现在列表顶部

#### 测试用例 2.2: 必填字段验证
**步骤**:
1. 打开新建实验表单
2. 只填写部分必填字段
3. 点击"保存实验"

**预期结果**:
- [ ] 浏览器显示"请填写此字段"提示
- [ ] 表单不提交
- [ ] 显示错误提示信息

#### 测试用例 2.3: 数值范围验证
**步骤**:
1. 打开新建实验表单
2. 填写磁化电流: "3000" (超过2000上限)
3. 点击"保存实验"

**预期结果**:
- [ ] 显示错误通知"磁化电流应在0-2000mA之间"
- [ ] 表单不提交

#### 测试用例 2.4: 实验列表显示
**步骤**:
1. 点击"MENU"按钮

**预期结果**:
- [ ] 显示所有实验列表
- [ ] 每个实验显示：项目名称、工件、日期、操作员
- [ ] 显示状态和缺陷数
- [ ] 按创建时间倒序排列

#### 测试用例 2.5: 实验搜索
**步骤**:
1. 在实验列表页面
2. 在搜索框输入"钢板"
3. 按回车或等待自动搜索

**预期结果**:
- [ ] 只显示包含"钢板"关键词的实验
- [ ] 搜索结果<1秒返回
- [ ] 清空搜索框恢复全部列表

#### 测试用例 2.6: 加载实验详情
**步骤**:
1. 在实验列表中点击某个实验

**预期结果**:
- [ ] 自动切换到波形图视图
- [ ] 顶部显示当前实验名称
- [ ] 显示"已加载: XXX"通知

---

### 3. US3 - 工业化控制界面

#### 测试用例 3.1: 界面外观验证
**步骤**:
1. 打开网站主页

**预期结果**:
- [ ] 橙色外框（#FF6B00）显示正确
- [ ] 黑色机身背景（#1A1A1A）
- [ ] 顶部显示"@NOVASCAN"
- [ ] 底部显示"DOPPLER"大型Logo
- [ ] 3个绿色LED指示灯闪烁

#### 测试用例 3.2: 按钮布局验证
**步骤**:
1. 检查左侧按钮面板

**预期结果**:
- [ ] 6个按钮垂直排列
- [ ] 从上到下：▶、↑、DISP、⏚、GATE、VPA
- [ ] 所有按钮为橙色金属质感
- [ ] 按钮大小一致（80x80px）

**步骤**:
2. 检查右侧按钮面板

**预期结果**:
- [ ] 3个按钮垂直排列
- [ ] 从上到下：↶、SAVE、MENU
- [ ] 按钮样式与左侧一致

#### 测试用例 3.3: 按钮交互效果
**步骤**:
1. 鼠标悬停在任意按钮上

**预期结果**:
- [ ] 按钮变亮
- [ ] 出现橙色光晕
- [ ] 按钮向上浮动2px

**步骤**:
2. 点击按钮

**预期结果**:
- [ ] 按钮向下移动4px（按下效果）
- [ ] 阴影减小
- [ ] 播放点击音效（如果启用）

#### 测试用例 3.4: 键盘快捷键
**步骤**:
1. 按下 F1

**预期结果**:
- [ ] 触发播放/暂停功能
- [ ] 等同于点击▶按钮

**步骤**:
2. 按下 Ctrl+S

**预期结果**:
- [ ] 触发保存功能
- [ ] 等同于点击SAVE按钮

**步骤**:
3. 按下 Esc

**预期结果**:
- [ ] 返回欢迎界面
- [ ] 等同于点击↶按钮

#### 测试用例 3.5: 响应式设计
**步骤**:
1. 调整浏览器窗口大小到 1366x768

**预期结果**:
- [ ] 界面缩放正常
- [ ] 按钮尺寸调整为 60x60px
- [ ] 所有元素可见

**步骤**:
2. 调整到 768x1024（平板）

**预期结果**:
- [ ] 布局切换为上下结构
- [ ] 按钮面板变为横向排列
- [ ] 内容区域居中显示

---

## 完整功能测试（Phase 6-11）

### 4. US4 - 缺陷记录与分析

#### 测试用例 4.1: 手动标记缺陷
**步骤**:
1. 波形监测中
2. 点击波形图上的某个点

**预期结果**:
- [ ] 弹出缺陷记录表单
- [ ] 自动填充时间戳和幅值
- [ ] 表单包含缺陷类型、位置、严重程度等字段

#### 测试用例 4.2: 保存缺陷记录
**步骤**:
1. 在缺陷记录表单中填写所有字段
2. 点击"保存缺陷记录"

**预期结果**:
- [ ] 数据保存到Supabase
- [ ] 显示"缺陷记录已保存"通知
- [ ] 表单自动关闭
- [ ] 实验的缺陷计数+1

### 5. US5 - 参数配置管理

#### 测试用例 5.1: 打开配置界面
**步骤**:
1. 点击参数配置按钮（需要添加到UI）

**预期结果**:
- [ ] 弹出配置对话框
- [ ] 显示所有配置参数
- [ ] 参数值为当前配置

#### 测试用例 5.2: 修改参数
**步骤**:
1. 修改磁化电流为 800
2. 修改增益为 60dB
3. 点击"应用配置"

**预期结果**:
- [ ] 参数验证通过
- [ ] 显示"配置应用成功"
- [ ] 系统使用新参数

### 6. US7 - 检测报告生成

#### 测试用例 7.1: 生成单个报告
**步骤**:
1. 加载一个完成的实验
2. 点击"生成报告"按钮

**预期结果**:
- [ ] 显示"正在生成报告..."
- [ ] 1-3秒后下载PDF文件
- [ ] PDF包含：封面、基本信息、参数、结果、缺陷列表
- [ ] 显示"报告生成成功！"

### 7. US8 - 权限管理

#### 测试用例 8.1: 用户登录
**步骤**:
1. 点击登录按钮（需要添加到UI）
2. 输入邮箱和密码
3. 点击"登录"

**预期结果**:
- [ ] 认证成功
- [ ] 显示"登录成功！"
- [ ] 页面刷新，显示用户信息

### 8. US9 - 数据导出

#### 测试用例 9.1: 导出CSV
**步骤**:
1. 加载一个实验
2. 点击"导出CSV"按钮

**预期结果**:
- [ ] 下载CSV文件
- [ ] 文件包含所有信号数据
- [ ] 可以在Excel中正常打开

---

## 性能测试

### 测试用例 P1: 页面加载速度
**步骤**:
1. 清除浏览器缓存
2. 访问网站
3. 记录加载时间

**预期结果**:
- [ ] 首屏加载时间 < 3秒
- [ ] 所有资源加载完成 < 5秒

### 测试用例 P2: 波形渲染性能
**步骤**:
1. 开启波形监测
2. 打开浏览器Performance工具
3. 记录FPS

**预期结果**:
- [ ] 平均FPS ≥ 30
- [ ] 无明显掉帧
- [ ] CPU使用率 < 50%

### 测试用例 P3: 数据库响应时间
**步骤**:
1. 创建实验并保存
2. 记录响应时间

**预期结果**:
- [ ] 创建实验 < 2秒
- [ ] 查询实验列表 < 1秒
- [ ] 保存缺陷 < 2秒

---

## 兼容性测试

### 测试矩阵

| 浏览器 | 版本 | 操作系统 | 状态 |
|--------|------|----------|------|
| Chrome | 90+ | Windows 10 | ✅ |
| Chrome | 90+ | macOS | ✅ |
| Edge | 90+ | Windows 10 | ✅ |
| Firefox | 88+ | Windows 10 | ✅ |
| Safari | 14+ | macOS | ⚠️ |

---

## 安全测试

### 测试用例 S1: XSS 防护
**步骤**:
1. 在项目名称中输入 `<script>alert('XSS')</script>`
2. 保存实验

**预期结果**:
- [ ] 脚本不执行
- [ ] 内容被转义显示

### 测试用例 S2: SQL 注入防护
**步骤**:
1. 在搜索框输入 `'; DROP TABLE experiments; --`
2. 执行搜索

**预期结果**:
- [ ] 查询正常执行
- [ ] 数据库表完好无损
- [ ] Supabase 自动防护SQL注入

---

## 测试报告模板

```
测试日期: YYYY-MM-DD
测试人员: XXX
测试环境: Windows 10 + Chrome 120

测试结果统计:
- 总用例数: XX
- 通过数: XX
- 失败数: XX
- 跳过数: XX
- 通过率: XX%

失败用例:
1. [用例编号] 问题描述
   - 重现步骤
   - 错误截图
   - 建议修复方案

性能指标:
- 页面加载时间: X.XX秒
- 波形渲染FPS: XX fps
- 数据库响应: X.XX秒

结论:
[  ] 通过 - 可以发布
[  ] 有问题 - 需要修复
```

---

## 测试自动化（未来）

建议使用以下工具进行自动化测试：

- **E2E测试**: Playwright / Cypress
- **单元测试**: Jest / Vitest
- **性能测试**: Lighthouse CI
- **视觉回归**: Percy / Chromatic

---

**测试计划版本**: v1.0  
**最后更新**: 2025-10-07
